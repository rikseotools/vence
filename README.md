# 🚀 Sistema iLoveTest - Plataforma Inteligente de Oposiciones

> **🧠 DIFERENCIADOR CLAVE**: No somos "otra web de tests" - somos el primer **Asistente Personal de Aprendizaje Legal** que aprende de ti y te guía inteligentemente hacia la excelencia.

## 🎯 **La Revolución: IA Personal + Tests Tradicionales**

### 🧠 **Sistema de Notificaciones Inteligentes** ⭐ *PIEDRA ANGULAR*
**Lo que nos hace únicos en el mercado:**

- **📊 Análisis Automático**: Tu comportamiento de estudio se convierte en insights personalizados
- **🎯 Predicción de Problemas**: Detecta regresiones antes de que las notes
- **💡 Motivación Adaptativa**: Solo cuando realmente aporta valor (no spam)
- **🚀 Acciones Directas**: Cada notificación lleva a una solución específica
- **⚡ Tiempo Real**: Aprende y se adapta constantemente a tu progreso

### 📈 **Tipos de Inteligencia Implementada:**

#### 🚨 **Alertas Críticas** (Prioridad 90-100)
- **Regresión de Nivel**: "Tu rendimiento en Art. 103 bajó 15% → Test de Refuerzo (5 min)"
- **Racha Rota**: "5 días sin estudiar → Test de Recuperación (3 min)"  
- **Artículos Problemáticos**: "LPAC Arts. 1,2,3 con <70% accuracy → Test Intensivo"

#### 🎯 **Recomendaciones Inteligentes** (Prioridad 70-89)
- **Optimización de Rachas**: "3 días seguidos → Mantener Racha (5 min)"
- **Logros Detectados**: "10 tests esta semana → Próximo Desafío"

#### 💡 **Motivación Adaptativa** (Solo cuando campana vacía)
- **Progreso Real**: "Llevas 4 días seguidos estudiando (2h 30m total)"
- **Mejoras Detectadas**: "Tu precisión en Tema 5 mejoró del 65% al 82%"
- **Velocidad**: "Respondes 3s más rápido que hace una semana"
- **Maestría**: "Has dominado 2 artículos nuevos: Tema 3 Art. 104 (89%)"
- **Patrones**: "Estudias mejor a las 19:00-20:00 (85% accuracy)"

> 📖 **[Ver documentación completa del Sistema de Inteligencia](./NOTIFICATIONS_SYSTEM.md)**

---

## 📋 **Sistema Base de Tests Avanzados**

Construido sobre la plataforma más completa del mercado:

- **Tests configurables** (25/50/100 preguntas)
- **Generación personalizada** (falladas/acertadas/aleatorias/mixtas)
- **Preguntas reutilizables** por artículo para múltiples oposiciones
- **Mapeo inteligente** tema → leyes → artículos específicos
- **Tracking granular** de errores por tema/ley/artículo
- **Sistema de usuarios** con Google OAuth
- **Analytics de progreso** y recomendaciones personalizadas
- **🆕 EXÁMENES OFICIALES EXACTOS** - Recreación de exámenes reales
- **🆕 CONTEXTO HISTÓRICO** - Artículos que "caen seguro" en exámenes
- **🎉 CONSTITUCIÓN ESPAÑOLA COMPLETA** - 169 artículos mapeados (100%)
- **🆕 CONTROL DE VERSIONES** - Sistema de actualización legal automático
- **🆕 ARQUITECTURA HÍBRIDA** - Consultas rápidas + análisis profundo
- **✨ MODO ADAPTATIVO** - Se ajusta automáticamente al rendimiento del usuario

---

## 🎯 Objetivos del Sistema

### ✅ Tests Dinámicos y Personalizados
- Configuración flexible de número de preguntas por test
- **Generación inteligente:** falladas, acertadas, aleatorias, mixtas
- **Mapeo preciso:** cada tema sabe exactamente qué leyes/artículos incluye
- **Tests por estructura legal:** Título Preliminar, Capítulo I, Sección 1ª, etc.
- Soporte para tests mixtos (múltiples temas/leyes)

### ✅ Arquitectura de Preguntas Reutilizables ⭐ *IMPLEMENTADO*
- **Preguntas asociadas a artículos específicos** (no a temas)
- **Reutilización automática** para múltiples oposiciones
- **Una pregunta del Art. 103 CE** sirve para Auxiliar Administrativo, Administrativo C1, Gestión Procesal, etc.
- **Zero duplicación** de contenido entre temas y oposiciones

### ✅ Sistema de Exámenes Oficiales ⭐ *REVOLUCIONARIO*
- **Recreación exacta** de exámenes oficiales reales
- **Preguntas idénticas** a las que aparecieron en convocatorias pasadas
- **Dos modalidades:**
  - **"Tema X - Solo preguntas oficiales"** - Preguntas que cayeron de ese tema
  - **"Examen Oficial 2023 Completo"** - Recreación exacta del examen real
- **Contexto histórico:** "Esta pregunta cayó en 2023, 2022, 2021"
- **Clasificación por frecuencia:** VERY_FREQUENT, FREQUENT, OCCASIONAL

### ✅ Inteligencia Contextual ⭐ *NUEVA GENERACIÓN*
- **Mensajes motivacionales:** "⚡ ¡MEMORIZA LITERALMENTE!" para artículos muy preguntados
- **Diferenciación por oposición:** Solo muestra contexto relevante para cada oposición específica
- **Estrategia de estudio:** Los usuarios saben exactamente qué priorizar
- **Arquitectura híbrida:** `article_exam_stats` para consultas rápidas + `articulos_examenes` para análisis histórico

### ✅ Control de Versiones Legal ⭐ *NUEVO*
- **Sistema de integridad:** Hashes SHA-256 para detectar cambios automáticamente
- **Verificación automática:** Alertas cuando una ley necesita actualización
- **Trazabilidad completa:** Historial de versiones de cada artículo
- **Fuentes oficiales:** Enlaces directos al BOE consolidado
- **Alertas inteligentes:** Priorización por urgencia (URGENTE, ALTA, MEDIA, BAJA)

### ✅ Repaso Inteligente
- **"25 preguntas falladas del Tema 5"** - Solo las que el usuario falla
- **"15 falladas + 10 aleatorias"** - Combinaciones personalizadas  
- **"Solo preguntas nunca vistas"** - Contenido fresco
- **✨ Modo Adaptativo Automático:** 
  - Se activa automáticamente cuando el rendimiento baja del 60%
  - Muestra indicador visual `✨ Adaptándose a tu nivel` en tiempo real
  - Disponible en tests aleatorios y por tema
  - Configuración opcional con toggle activado por defecto

### ✅ Mapeo Tema ↔ Contenido Legal
- **Tema 5 Auxiliar Administrativo** → CE Art. 103-106 + LRJSP Cap. I
- **Tema 8 Administrativo C1** → CE Art. 103-106 (reutiliza mismas preguntas)
- **Flexibilidad total:** artículos específicos, títulos completos, capítulos, etc.

### ✅ Tracking Inteligente
- Registro de errores por usuario, tema, ley y artículo
- Seguimiento temporal del progreso
- Identificación automática de puntos débiles
- Métricas de mejora por área de conocimiento

### ✅ Sistema de Usuarios
- Autenticación con Google OAuth
- Progreso persistente en la nube
- Perfil personalizado de aprendizaje
- Acceso multiplataforma

---

## 🏗️ Arquitectura de Base de Datos

### 📊 **Esquema Completo (25 tablas principales)**

```
📚 CONTENIDO LEGAL (4 tablas)
├── laws - Normativa legal (CE, LPAC, etc.)
├── articles - Artículos específicos de cada ley  
├── topics - Temas de oposiciones estructurados
└── topic_scope - Mapeo inteligente tema ↔ artículos

❓ PREGUNTAS Y TESTS (4 tablas)
├── questions - Preguntas reutilizables por artículo
├── test_configurations - Configuraciones guardadas de tests
├── test_questions - Relación tests ↔ preguntas
└── tests - Sesiones de tests completadas

🎯 EXÁMENES OFICIALES (6 tablas) ⭐ IMPLEMENTADO
├── oposiciones - Tipos de oposiciones disponibles
├── convocatorias - Años y detalles de exámenes
├── articulos_examenes - Historial de artículos en exámenes
├── preguntas_examenes_oficiales - Preguntas exactas de exámenes
├── oposicion_topics - Mapeo oposición ↔ temas
└── oposicion_articles - Mapeo directo oposición ↔ artículos

🆕 NUEVA ARQUITECTURA HÍBRIDA (1 tabla) ⭐ REVOLUCIONARIO
└── article_exam_stats - Estadísticas agregadas para consultas rápidas

🆕 CONTROL DE VERSIONES (4 tablas) ⭐ NUEVO
├── law_versions - Historial de versiones de leyes
├── article_versions - Historial de versiones de artículos
├── version_checks - Programación de verificaciones
└── law_update_status - Vista de estado actualización

✨ SISTEMA IA ADAPTATIVO (4 tablas) ⭐ REVOLUCIONARIO
├── user_question_history - Historial personal por pregunta
├── user_difficulty_metrics - Métricas agregadas de dificultad
├── user_sessions - Sesiones detalladas de usuario
└── user_learning_analytics - Analytics de aprendizaje

👤 USUARIOS Y PROGRESO (4 tablas)
├── user_profiles - Perfiles y preferencias
├── user_progress - Progreso detallado por artículo
├── user_recommendations - Recomendaciones personalizadas
└── user_notifications - Sistema de notificaciones inteligentes
```

---

## 📋 **Nuevas Tablas Clave Implementadas**

### 🆕 **Table: `article_exam_stats`** - Arquitectura Híbrida ⭐ *REVOLUCIONARIO*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del registro |
| `article_id` | uuid (FK) | Referencia al artículo |
| `oposicion_id` | uuid (FK) | Referencia a la oposición |
| `total_appearances` | integer | Total de apariciones en exámenes |
| `years_appeared` | integer[] | Array de años en que apareció [2021,2022,2023] |
| `first_appearance` | integer | Primer año de aparición |
| `last_appearance` | integer | Último año de aparición |
| `classification` | text | Clasificación: VERY_FREQUENT, FREQUENT, OCCASIONAL |
| `user_message` | text | Mensaje para el usuario: "⚡ ¡MEMORIZA LITERALMENTE!" |
| `source_table` | text | Tabla de origen de los datos |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

**CONSTRAINT ÚNICO:** `(article_id, oposicion_id)` - Imposible tener duplicados

### 🆕 **Table: `law_versions`** - Control de Versiones ⭐ *NUEVO*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la versión |
| `law_id` | uuid (FK) | Referencia a la ley |
| `version_number` | text | Número de versión (ej: "1.0", "1.1") |
| `content_hash` | text | Hash SHA-256 de todo el contenido |
| `boe_reference` | text | Referencia oficial del BOE |
| `change_description` | text | Descripción de los cambios realizados |
| `verification_date` | date | Fecha de verificación |
| `next_verification_date` | date | Próxima fecha de verificación programada |
| `verification_priority` | text | Prioridad: URGENT, HIGH, MEDIUM, LOW |
| `is_current_version` | boolean | Si es la versión actual |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

### 🆕 **Table: `article_versions`** - Historial de Artículos ⭐ *NUEVO*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la versión |
| `article_id` | uuid (FK) | Referencia al artículo |
| `law_version_id` | uuid (FK) | Referencia a la versión de la ley |
| `version_number` | text | Número de versión del artículo |
| `content_hash` | text | Hash SHA-256 del contenido del artículo |
| `content` | text | Contenido histórico del artículo |
| `change_description` | text | Descripción específica del cambio |
| `verification_date` | date | Fecha de verificación del artículo |
| `is_current_version` | boolean | Si es la versión actual del artículo |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

---

## 🔧 Funciones SQL Implementadas

### 📈 Funciones SQL Operativas ⭐ *25+ FUNCIONES AVANZADAS*
```
✅ GENERACIÓN DE TESTS:
├── get_topic_questions_v2() - Preguntas por tema
├── generate_test_by_topic() - Generador de tests dinámicos
├── get_article_questions() - Preguntas específicas por artículo

✅ EXÁMENES OFICIALES ⭐ IMPLEMENTADO:
├── get_examen_oficial_exacto() - Recrear examen oficial completo
├── get_preguntas_oficiales_por_tema() - Solo preguntas que cayeron
├── get_estadisticas_examenes_oficiales() - Stats de cobertura
├── get_articles_missing_questions() - Prioridades para crear preguntas

✅ CONTEXTO INTELIGENTE ⭐ IMPLEMENTADO:
├── get_question_exam_context_v2() - Contexto histórico por oposición
├── get_article_context_final() - Función híbrida optimizada
├── get_oposicion_articles() - Artículos de una oposición específica
├── get_oposicion_coverage_stats() - Estadísticas de cobertura

✅ CONTROL DE VERSIONES ⭐ NUEVO:
├── generate_content_hash() - Generación de hashes SHA-256
├── check_law_update_needed() - Verificar si ley necesita actualización
├── get_laws_needing_verification() - Leyes pendientes de verificación
├── migrate_existing_exam_data() - Migración de datos históricos

✅ ANÁLISIS Y ESTADÍSTICAS:
├── get_question_stats_by_position() - Estadísticas por oposición
├── get_official_exam_coverage_stats() - Cobertura exámenes oficiales
├── get_user_progress_analytics() - Analytics de progreso de usuario
├── get_recommendation_engine() - Motor de recomendaciones

✨ SISTEMA IA ADAPTATIVO ⭐ NUEVO:
├── calculate_personal_difficulty() - Algoritmo de dificultad personal
├── calculate_trend() - Análisis de tendencias de progreso
├── update_user_question_history() - Trigger automático de actualización
├── migrate_existing_data() - Migración de datos históricos
├── get_personal_difficulty_breakdown() - Distribución personal
└── get_personalized_recommendations() - Recomendaciones IA
```

---

## 📋 **Documentación Completa de Tablas**

### 📚 **CONTENIDO LEGAL**

#### 🏛️ **Table: `laws`** - Normativa Legal
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la ley |
| `name` | text | Nombre completo oficial (ej: "Constitución Española de 1978") |
| `short_name` | text | Nombre abreviado para referencias (ej: "CE", "LPAC") |
| `year` | integer | Año de promulgación de la ley |
| `type` | text | Tipo de norma: "constitucional", "ley_organica", "ley_ordinaria", "real_decreto" |
| `scope` | text | Ámbito de aplicación: "nacional", "autonomico", "local" |
| `description` | text | Descripción y objeto de la ley |
| `is_active` | boolean | Si la ley está vigente y disponible para tests |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📖 **Table: `articles`** - Artículos Específicos
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del artículo |
| `law_id` | uuid (FK) | Referencia a la ley a la que pertenece |
| `article_number` | text | Número del artículo (ej: "103", "104", "bis") |
| `title` | text | Título o epígrafe del artículo |
| `content` | text | Contenido completo del artículo |
| `title_number` | text | Número del título al que pertenece (estructura jerárquica) |
| `chapter_number` | text | Número del capítulo al que pertenece |
| `section_number` | text | Número de la sección al que pertenece |
| `content_hash` | text | Hash SHA-256 del contenido para control de versiones |
| `verification_date` | date | Fecha de última verificación |
| `is_verified` | boolean | Si el contenido ha sido verificado |
| `is_active` | boolean | Si el artículo está disponible para tests |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📚 **Table: `topics`** - Temas de Oposiciones
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del tema |
| `position_type` | text | Tipo de oposición: "auxiliar_administrativo", "administrativo_c1", etc. |
| `topic_number` | integer | Número del tema dentro de la oposición (1, 2, 3...) |
| `name` | text | Nombre completo del tema (ej: "Tema 5: La Administración Pública") |
| `description` | text | Descripción detallada del contenido del tema |
| `difficulty` | text | Nivel de dificultad: "facil", "medio", "dificil" |
| `estimated_hours` | numeric | Horas estimadas de estudio para dominar el tema |
| `is_active` | boolean | Si el tema está disponible para tests |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 🗂️ **Table: `topic_scope`** - Mapeo Tema ↔ Artículos ⭐ *CLAVE*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del mapeo |
| `topic_id` | uuid (FK) | Referencia al tema |
| `law_id` | uuid (FK) | Referencia a la ley |
| `article_numbers` | text[] | Array de números de artículos específicos ['103', '104', '105'] |
| `title_numbers` | text[] | Array de títulos completos a incluir |
| `chapter_numbers` | text[] | Array de capítulos completos a incluir |
| `include_full_title` | boolean | Si incluir todo el título completo |
| `include_full_chapter` | boolean | Si incluir todo el capítulo completo |
| `weight` | numeric | Peso/importancia del contenido en el tema (0.1-1.0) |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

---

### ❓ **PREGUNTAS Y TESTS**

#### ❓ **Table: `questions`** - Preguntas Reutilizables ⭐ *ARQUITECTURA REVOLUCIONARIA*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la pregunta |
| `primary_article_id` | uuid (FK) | **CLAVE**: Artículo principal al que se refiere (reutilización) |
| `question_text` | text | Texto completo de la pregunta |
| `option_a` | text | Opción A de respuesta |
| `option_b` | text | Opción B de respuesta |
| `option_c` | text | Opción C de respuesta |
| `option_d` | text | Opción D de respuesta |
| `correct_option` | text | Opción correcta: "a", "b", "c", "d" |
| `explanation` | text | Explicación detallada de por qué es correcta |
| `difficulty` | text | Dificultad: "facil", "medio", "dificil" |
| `question_type` | text | Tipo: "teorica", "practica", "caso_practico" |
| `tags` | text[] | Etiquetas para categorización ['principios', 'competencias'] |
| `is_active` | boolean | Si la pregunta está disponible para tests |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📊 **Table: `test_configurations`** - Configuraciones de Tests
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la configuración |
| `user_id` | uuid (FK) | Usuario propietario de la configuración |
| `name` | text | Nombre de la configuración (ej: "Tema 5 - Repaso falladas") |
| `topic_id` | uuid (FK) | Tema principal del test (puede ser NULL para tests mixtos) |
| `total_questions` | integer | Número total de preguntas del test |
| `question_distribution` | text | Distribución: "only_unseen_questions", "mixed", "failed_only" |
| `only_unseen_questions` | boolean | Solo preguntas nunca vistas por el usuario |
| `time_limit_minutes` | integer | Límite de tiempo en minutos (NULL = sin límite) |
| `is_completed` | boolean | Si el test ha sido completado |
| `created_at` | timestamp | Fecha de creación de la configuración |
| `updated_at` | timestamp | Última actualización de la configuración |

#### 🔗 **Table: `test_questions`** - Relación Tests ↔ Preguntas
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la relación |
| `test_id` | uuid (FK) | Referencia al test |
| `question_id` | uuid (FK) | Referencia a la pregunta |
| `question_order` | integer | Orden de la pregunta en el test (1, 2, 3...) |
| `user_answer` | text | Respuesta del usuario: "a", "b", "c", "d" |
| `is_correct` | boolean | Si la respuesta fue correcta |
| `fixacion` | text | Nivel de fijación del conocimiento |
| `time_spent_seconds` | integer | Tiempo empleado en responder (segundos) |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📝 **Table: `tests`** - Sesiones de Tests
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del test |
| `user_id` | uuid (FK) | Usuario que realizó el test |
| `title` | text | Título del test (ej: "Test Tema 5 - 25 preguntas") |
| `test_type` | text | Tipo: "practice", "official_exam", "mixed" |
| `total_questions` | integer | Número total de preguntas |
| `time_limit_minutes` | integer | Tiempo límite establecido |
| `started_at` | timestamp | Fecha/hora de inicio del test |
| `completed_at` | timestamp | Fecha/hora de finalización (NULL si no terminado) |
| `is_completed` | boolean | Si el test fue completado |
| `score` | numeric | Puntuación obtenida (0-100) |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

---

### 🎯 **EXÁMENES OFICIALES** ⭐ *IMPLEMENTADO*

#### 🏆 **Table: `oposiciones`** - Tipos de Oposiciones
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la oposición |
| `nombre` | text | Nombre oficial completo (ej: "Auxiliar Administrativo del Estado") |
| `tipo_acceso` | text | Tipo de acceso: "libre", "promocion_interna" |
| `administracion` | text | Administración: "estado", "autonomica", "local" |
| `categoria` | text | Categoría profesional: "C2", "C1", "A2", "A1" |
| `descripcion` | text | Descripción de las funciones del puesto |
| `is_active` | boolean | Si la oposición está activa para tests |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📅 **Table: `convocatorias`** - Convocatorias por Año
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la convocatoria |
| `oposicion_id` | uuid (FK) | Referencia a la oposición |
| `año` | integer | Año de la convocatoria (2023, 2022, 2021...) |
| `fecha_examen` | date | Fecha en que se celebró el examen |
| `boe_numero` | text | Número del BOE de la convocatoria |
| `plazas_convocadas` | integer | Número de plazas ofertadas |
| `observaciones` | text | Detalles adicionales (nota de corte, incidencias, etc.) |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 🔥 **Table: `articulos_examenes`** - Historial de Artículos ⭐ *INTELIGENCIA*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del registro |
| `convocatoria_id` | uuid (FK) | Referencia a la convocatoria específica |
| `article_id` | uuid (FK) | Referencia al artículo que apareció |
| `frecuencia_aparicion` | integer | Número de veces que apareció en esa convocatoria |
| `tipo_pregunta` | text | Tipo: "teorica", "practica", "caso_practico" |
| `puntos_pregunta` | numeric | Puntos que valía la pregunta (si se conoce) |
| `observaciones` | text | Contexto adicional sobre la aparición |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📝 **Table: `preguntas_examenes_oficiales`** - Preguntas Exactas ⭐ *REVOLUCIONARIO*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la pregunta oficial |
| `convocatoria_id` | uuid (FK) | Referencia a la convocatoria específica |
| `numero_pregunta` | integer | Número de la pregunta en el examen (1, 2, 3... hasta 60) |
| `parte_examen` | text | Parte: "organizacion_publica", "ofimatica", "psicotecnico" |
| `pregunta_text` | text | **TEXTO EXACTO** de la pregunta oficial |
| `opcion_a` | text | Opción A exacta del examen oficial |
| `opcion_b` | text | Opción B exacta del examen oficial |
| `opcion_c` | text | Opción C exacta del examen oficial |
| `opcion_d` | text | Opción D exacta del examen oficial |
| `respuesta_correcta` | text | Respuesta correcta oficial: "a", "b", "c", "d" |
| `article_id` | uuid (FK) | Artículo al que se refiere (NULL para psicotécnicas) |
| `topic_estimado` | text | Tema estimado al que pertenece |
| `explicacion` | text | Explicación de la respuesta correcta |
| `fue_anulada` | boolean | Si la pregunta fue anulada oficialmente |
| `observaciones` | text | Contexto adicional sobre la pregunta |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 🔗 **Table: `oposicion_topics`** - Mapeo Oposición ↔ Temas
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del mapeo |
| `oposicion_id` | uuid (FK) | Referencia a la oposición |
| `topic_id` | uuid (FK) | Referencia al tema |
| `es_tema_principal` | boolean | Si es un tema principal o complementario |
| `peso_examen` | numeric | Peso del tema en el examen (% aproximado) |
| `observaciones` | text | Notas sobre la importancia del tema |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 🎯 **Table: `oposicion_articles`** - Mapeo Directo Oposición ↔ Artículos
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del mapeo |
| `oposicion_id` | uuid (FK) | Referencia a la oposición |
| `article_id` | uuid (FK) | Referencia al artículo |
| `importancia` | text | Importancia: "alta", "media", "baja" |
| `observaciones` | text | Contexto sobre por qué está en esta oposición |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

---

### 🆕 **ARQUITECTURA HÍBRIDA** ⭐ *REVOLUCIONARIO*

#### 🚀 **Table: `article_exam_stats`** - Estadísticas Optimizadas ⭐ *NUEVO*
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del registro |
| `article_id` | uuid (FK) | Referencia al artículo |
| `oposicion_id` | uuid (FK) | Referencia a la oposición |
| `total_appearances` | integer | Total de apariciones en exámenes |
| `years_appeared` | integer[] | Array de años en que apareció [2021,2022,2023] |
| `first_appearance` | integer | Primer año de aparición |
| `last_appearance` | integer | Último año de aparición |
| `classification` | text | Clasificación: VERY_FREQUENT, FREQUENT, OCCASIONAL |
| `user_message` | text | Mensaje para el usuario: "⚡ ¡MEMORIZA LITERALMENTE!" |
| `source_table` | text | Tabla de origen de los datos para trazabilidad |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

**CONSTRAINT ÚNICO:** `UNIQUE(article_id, oposicion_id)` - Imposible tener duplicados

---

### 🆕 **CONTROL DE VERSIONES** ⭐ *NUEVO*

#### 📚 **Table: `law_versions`** - Historial de Versiones de Leyes
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la versión |
| `law_id` | uuid (FK) | Referencia a la ley |
| `version_number` | text | Número de versión (ej: "1.0", "1.1") |
| `content_hash` | text | Hash SHA-256 de todo el contenido de la ley |
| `boe_reference` | text | Referencia oficial del BOE (ej: "BOE-A-1978-31229") |
| `boe_url` | text | URL directa al BOE consolidado |
| `change_description` | text | Descripción de los cambios realizados |
| `verification_date` | date | Fecha de verificación de la versión |
| `next_verification_date` | date | Próxima fecha de verificación programada |
| `verification_priority` | text | Prioridad: URGENT, HIGH, MEDIUM, LOW |
| `is_current_version` | boolean | Si es la versión actual |
| `verification_notes` | text | Notas adicionales sobre la verificación |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📖 **Table: `article_versions`** - Historial de Versiones de Artículos
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la versión |
| `article_id` | uuid (FK) | Referencia al artículo |
| `law_version_id` | uuid (FK) | Referencia a la versión de la ley |
| `version_number` | text | Número de versión del artículo (ej: "1.0", "1.1") |
| `content_hash` | text | Hash SHA-256 del contenido del artículo |
| `content` | text | Contenido histórico del artículo |
| `title` | text | Título histórico del artículo |
| `change_description` | text | Descripción específica del cambio en el artículo |
| `verification_date` | date | Fecha de verificación del artículo |
| `is_current_version` | boolean | Si es la versión actual del artículo |
| `change_type` | text | Tipo de cambio: "content", "title", "structure" |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📅 **Table: `version_checks`** - Programación de Verificaciones
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la verificación |
| `law_id` | uuid (FK) | Referencia a la ley a verificar |
| `check_type` | text | Tipo: "automatic", "manual", "scheduled" |
| `scheduled_date` | date | Fecha programada para la verificación |
| `check_frequency` | text | Frecuencia: "monthly", "quarterly", "yearly" |
| `priority` | text | Prioridad: URGENT, HIGH, MEDIUM, LOW |
| `check_status` | text | Estado: "pending", "completed", "failed" |
| `last_check_date` | date | Fecha de la última verificación |
| `next_check_date` | date | Fecha de la próxima verificación |
| `notification_enabled` | boolean | Si están habilitadas las notificaciones |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 📊 **View: `law_update_status`** - Vista de Estado de Actualización
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `law_id` | uuid | Identificador de la ley |
| `law_name` | text | Nombre de la ley |
| `short_name` | text | Nombre abreviado |
| `current_version` | text | Versión actual |
| `last_verification_date` | date | Última verificación |
| `next_verification_date` | date | Próxima verificación |
| `verification_priority` | text | Prioridad de verificación |
| `status_display` | text | Estado para mostrar: "✅ Actualizada", "⚠️ Pendiente", "🚨 Urgente" |
| `days_until_verification` | integer | Días hasta próxima verificación |
| `articles_count` | integer | Número total de artículos |
| `articles_with_hash` | integer | Artículos con hash generado |

---

### 👤 **USUARIOS Y PROGRESO**

#### 👤 **Table: `user_profiles`** - Perfiles de Usuario
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del perfil |
| `user_id` | uuid (FK) | Referencia al usuario de auth.users |
| `email` | text | Email del usuario |
| `full_name` | text | Nombre completo del usuario |
| `avatar_url` | text | URL del avatar/foto de perfil |
| `preferred_language` | text | Idioma preferido: "es", "en" |
| `study_goal` | text | Objetivo de estudio del usuario |
| `target_oposicion` | text | Oposición objetivo del usuario |
| `study_hours_per_day` | numeric | Horas de estudio diarias objetivo |
| `notification_preferences` | jsonb | Preferencias de notificaciones |
| `is_active` | boolean | Si el perfil está activo |
| `created_at` | timestamp | Fecha de creación del perfil |
| `updated_at` | timestamp | Última actualización del perfil |

#### 📈 **Table: `user_progress`** - Progreso Detallado
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único del progreso |
| `user_id` | uuid (FK) | Referencia al usuario |
| `topic_id` | uuid (FK) | Referencia al tema (NULL para progreso general) |
| `law_id` | uuid (FK) | Referencia a la ley (NULL para progreso general) |
| `article_id` | uuid (FK) | Referencia al artículo específico |
| `total_attempts` | integer | Número total de intentos/preguntas respondidas |
| `correct_attempts` | integer | Número de respuestas correctas |
| `accuracy_percentage` | numeric | Porcentaje de aciertos (calculado automáticamente) |
| `last_attempt_date` | timestamp | Fecha del último intento |
| `needs_review` | boolean | Si necesita repaso (algoritmo automático) |
| `study_time_seconds` | integer | Tiempo total de estudio en segundos |
| `difficulty_level` | text | Nivel de dificultad percibido por el usuario |
| `confidence_level` | text | Nivel de confianza: "low", "medium", "high" |
| `created_at` | timestamp | Fecha de creación del registro |
| `updated_at` | timestamp | Última actualización del registro |

#### 💡 **Table: `user_recommendations`** - Recomendaciones Personalizadas
| Campo | Tipo | Descripción |
|-------|------|-------------|
| `id` | uuid (PK) | Identificador único de la recomendación |
| `user_id` | uuid (FK) | Referencia al usuario |
| `recommendation_type` | text | Tipo: "topic_review", "article_focus", "exam_simulation" |
| `title` | text | Título de la recomendación |
| `description` | text | Descripción detallada de qué hacer |
| `topic_id` | uuid (FK) | Tema recomendado (si aplica) |
| `article_id` | uuid (FK) | Artículo recomendado (si aplica) |
| `priority` | text | Prioridad: "alta", "media", "baja" |
| `recommendation_score` | numeric | Puntuación de la recomendación (0-100) |
| `is_dismissed` | boolean | Si el usuario descartó la recomendación |
| `is_completed` | boolean | Si la recomendación fue completada |
| `expires_at` | timestamp | Fecha de expiración de la recomendación |
| `created_at` | timestamp | Fecha de creación de la recomendación |
| `updated_at` | timestamp | Última actualización de la recomendación |

---

## 🔗 **Relaciones Clave y Constraints**

### **Constraints Únicos Implementados:**
```sql
-- Garantizar una sola estadística por artículo-oposición
ALTER TABLE article_exam_stats 
ADD CONSTRAINT unique_article_oposicion 
UNIQUE (article_id, oposicion_id);

-- Evitar duplicados en mapeo de temas
ALTER TABLE topic_scope 
ADD CONSTRAINT unique_topic_law_scope 
UNIQUE (topic_id, law_id);

-- Una sola convocatoria por año-oposición
ALTER TABLE convocatorias 
ADD CONSTRAINT unique_convocatoria_year 
UNIQUE (oposicion_id, año);
```

### **Índices de Performance:**
```sql
-- Índices para consultas rápidas
CREATE INDEX idx_articles_law_number ON articles(law_id, article_number);
CREATE INDEX idx_questions_article ON questions(primary_article_id);
CREATE INDEX idx_article_stats_classification ON article_exam_stats(classification);
CREATE INDEX idx_article_versions_current ON article_versions(article_id, is_current_version);
CREATE INDEX idx_user_progress_article ON user_progress(user_id, article_id);
```

### **Triggers Implementados:**
```sql
-- Actualizar hash automáticamente cuando cambia content
CREATE TRIGGER update_article_hash 
BEFORE UPDATE ON articles 
FOR EACH ROW EXECUTE FUNCTION update_content_hash();

-- Sincronizar article_exam_stats cuando cambia articulos_examenes
CREATE TRIGGER sync_exam_stats 
AFTER INSERT OR UPDATE ON articulos_examenes 
FOR EACH ROW EXECUTE FUNCTION sync_article_exam_stats();
```

## 🚀 Casos de Uso Revolucionarios

### 📖 Tests Personalizados Avanzados
```
"Test Tema 5 - 25 preguntas aleatorias"
"Test Tema 7 - 20 falladas + 5 aleatorias"
"Test Art. 103 CE específico - 10 preguntas"
"Test solo preguntas nunca vistas - 50 preguntas"
"Simulacro oficial - 100 preguntas mixtas"
"Repaso errores última semana"
"Test Título Preliminar CE - 15 preguntas"
"Test Capítulo II Sección 1ª - Derechos fundamentales"
```

### ✨ **Modo Adaptativo (IMPLEMENTADO)** ⭐ *NUEVO*
```
Usuario iniciando test con 25 preguntas:
├── Pregunta 1: ✅ Correcta (100% aciertos)
├── Pregunta 2: ❌ Incorrecta (50% aciertos)
├── Pregunta 3: ❌ Incorrecta (33% aciertos)
└── 🎯 SISTEMA DETECTA: <60% → Activa modo adaptativo

Indicador visual automático:
├── ✨ "Adaptándose a tu nivel" (con animación pulse)
├── Mensaje: "✨ Adaptando las preguntas a tu nivel (33% aciertos)"
└── Usuario sabe que el sistema está optimizando su experiencia
```

### 🎯 **Exámenes Oficiales (IMPLEMENTADO)** ⭐ *GAME CHANGER*
```
"Examen Oficial 2023 - 17 septiembre (EXACTO)"
├── 60 preguntas IDÉNTICAS a las que aparecieron
├── Mismas opciones, mismo orden
├── Experiencia 100% real del examen oficial
└── Corrección automática con plantilla oficial

"Tema 5 - Solo preguntas oficiales"  
├── Art. 103 CE → "Cayó en 2023, 2022, 2021" (VERY_FREQUENT)
├── Art. 104 CE → "Cayó en 2023" (OCCASIONAL)
└── Solo preguntas que HAN APARECIDO en exámenes reales

"Simulacro Estratégico"
├── Prioriza artículos VERY_FREQUENT  
├── Distribución realista por temas
└── Enfoque en contenido que "cae seguro"
```

### 🆕 **Control de Versiones (NUEVO)** ⭐ *INTEGRIDAD GARANTIZADA*
```
"Verificación Automática de Leyes"
├── Hash CE: a3f5d9e8... ✅ Verificada 2024-12-26
├── Hash LPAC: b2e4c7f1... ⚠️ Pendiente verificación
├── Hash LRJSP: c5d8a2b9... 🚨 Necesita actualización
└── Alertas automáticas por prioridad

"Trazabilidad Completa"
├── Art. 103 CE v1.0 → Hash: xyz123... (2024-01-15)
├── Art. 103 CE v1.1 → Hash: abc456... (2024-06-20)
└── Historial completo de cambios detectados

"Función de Consulta Rápida"
├── get_article_context_final('103', 'Auxiliar')
├── Resultado: FREQUENT, 3 apariciones, "📚 Repasar bien"
└── Performance optimizada con arquitectura híbrida
```

### 🎯 Mapeo Inteligente Implementado
```
✅ Tema 5 Auxiliar Administrativo:
├── CE Art. 103, 104, 105
├── 4 preguntas reutilizables cargadas
└── 🔥 Art. 103 = "FREQUENT" (3 apariciones históricas)

✅ Tema 7 Auxiliar Administrativo:
├── Ley 19/2013 Art. 1,2,3,5,12,13,14,24,25,26,33,37
├── 12 artículos fundamentales mapeados
└── 🔥 Art. 13, 14 = "FREQUENT" (2 apariciones cada uno)

⏳ Tema 1:
├── CE Título Preliminar (Art. 1-9)
├── CE Título I, Capítulo II, Sección 1ª
└── Pendiente de mapear
```

### 🔄 **Reutilización Inteligente** ⭐ *IMPLEMENTADO*
```
Art. 103 CE → 4 preguntas creadas
├── ✅ Auxiliar Administrativo Tema 5 (las usa automáticamente)
├── ⏳ Administrativo C1 Tema 8 (las reutilizará cuando se configure)
├── ⏳ Gestión Procesal Tema 12 (las reutilizará cuando se configure)
└── ⏳ Cualquier nueva oposición (reutilización automática)

Contexto diferenciado por oposición:
├── Auxiliar Admin: "🎯 FREQUENT - 3 apariciones (última: 2023)"
├── Admin C1: "📝 OCCASIONAL - 1 aparición (2022)"
└── Gestión Procesal: (Sin contexto - no ha caído en esa oposición)
```

### 🎯 **Contexto de Exámenes Oficiales** ⭐ *ARQUITECTURA HÍBRIDA*
```
Art. 103 CE en examen Auxiliar Administrativo:
├── 📊 Historial: [2021,2022,2023] (3 apariciones)
├── 🎯 Clasificación: FREQUENT
├── 📢 Mensaje: "📚 Repasar bien"
└── ⚡ Consulta híbrida optimizada

Art. 13 Ley 19/2013 en examen Auxiliar Administrativo:
├── 📊 Historial: [2022,2023] (2 apariciones)
├── 🎯 Clasificación: FREQUENT
├── 📢 Mensaje: "📚 Repasar bien"
└── 🔄 Datos consolidados sin duplicados

Art. 50 CE en examen Auxiliar Administrativo:
├── ❌ No está en temario Auxiliar
└── 🔇 Sin contexto (no se muestra)
```

---

## 🔧 Stack Tecnológico

### Frontend (Existente)
- **Next.js 14** con App Router
- **Tailwind CSS** para estilos
- **Componentes React** para interactividad

### Backend (Implementado)
- **Supabase** como backend-as-a-service
- **PostgreSQL** con 21 tablas especializadas
- **19 funciones SQL** para lógica de negocio
- **Row Level Security** para privacidad
- **🆕 Sistema de hashes** para integridad de datos
- **🆕 Control de versiones** automatizado

### Autenticación y Usuarios
- **Supabase Auth** con Google OAuth
- **Perfiles de usuario** persistentes
- **Progreso multiplataforma**

### Analytics e Inteligencia
- **Sistema de recomendaciones** basado en IA
- **Análisis predictivo** de rendimiento
- **Contexto histórico** de exámenes oficiales
- **🆕 Arquitectura híbrida** para performance optimizada
- **🆕 Control de integridad** automático

---

## 📊 Métricas de Éxito

### Para Usuarios
- **Retención:** Sesiones recurrentes de estudio
- **Progreso:** Mejora medible en puntuaciones
- **Engagement:** Tiempo de estudio por sesión
- **Satisfacción:** Completación de tests largos
- **🆕 Estrategia:** Enfoque optimizado en artículos "VERY_FREQUENT"
- **🆕 Confianza:** Experiencia real con exámenes oficiales exactos
- **🆕 Fiabilidad:** Contenido siempre actualizado automáticamente

### Para el Sistema
- **Calidad de preguntas:** Tasa de aciertos por pregunta
- **Dificultad real:** Análisis estadístico de errores
- **Patrones de uso:** Horarios y frecuencia de estudio
- **Contenido efectivo:** Qué temas/leyes generan más engagement
- **🆕 Precisión histórica:** Correlación exámenes oficiales vs. predicciones
- **🆕 Reutilización:** Tasa de reutilización de preguntas entre oposiciones
- **🆕 Integridad:** 100% de contenido verificado y actualizado

---

## 🛠️ Estado de Implementación

### Fase 1: Infraestructura Base ✅ **COMPLETADO**
- ✅ Configuración de Supabase (Project ID: yqbpstxowvgipqspqrgo)
- ✅ Diseño de esquema de base de datos (**21 tablas principales**)
- ✅ **Arquitectura de preguntas reutilizables** implementada
- ✅ Sistema de mapeo tema → contenido legal (topic_scope)
- ✅ **19 funciones SQL especializadas** funcionando
- ✅ **Nueva arquitectura questions → articles** (no topics)
- ✅ **🆕 Sistema completo de exámenes oficiales**
- ✅ **🆕 Contexto histórico inteligente por oposición**
- ✅ **🆕 Control de versiones completo** con hashes SHA-256
- ✅ **🆕 Arquitectura híbrida** para performance optimizada

### Fase 2: Contenido Legal ✅ **HISTÓRICO - COMPLETADO**
- ✅ **🎉 Constitución Española COMPLETA** - **169/169 artículos** (100%)
- ✅ **📊 Estructura jerárquica completa** - Títulos, Capítulos, Secciones
- ✅ **🏛️ Texto consolidado oficial BOE** - Incluye reformas 1992 y 2011
- ✅ **🆕 Hashes SHA-256** generados para todos los artículos
- ✅ **🆕 Sistema de verificación** automática implementado
- ✅ **🆕 Control de duplicados** resuelto definitivamente
- ✅ **Ley 19/2013 de Transparencia** completa (12 artículos clave)
- ✅ **Tema 7 Auxiliar Administrativo** mapeado completamente
- ✅ **Tema 5 Auxiliar Administrativo** mapeado parcialmente
- ✅ **🆕 4 oposiciones configuradas** con mapeo de temas
- ✅ **🆕 Historial exámenes 2021-2023** para múltiples artículos
- ✅ **🆕 5 artículos confirmados** en examen oficial 2023
- ⏳ LPAC y LRJSP principales artículos
- ⏳ **🆕 Más exámenes oficiales** (2021, 2022) para historial completo

### Fase 3: Preguntas y Exámenes ✅ **REVOLUCIONARIO**
- ✅ **4 preguntas súper difíciles** Art. 103 CE implementadas
- ✅ **Arquitectura de reutilización** funcionando perfectamente
- ✅ **🆕 Sistema de exámenes oficiales exactos** implementado
- ✅ **🆕 2 preguntas oficiales reales** del examen 2023 registradas
- ✅ **🆕 Contexto histórico** integrado en todas las preguntas
- ✅ **🆕 Tabla preguntas_examenes_oficiales** creada y operativa
- ✅ **🆕 Arquitectura híbrida article_exam_stats** funcionando
- ✅ **🆕 Sistema sin duplicados** garantizado con constraints únicos
- ✅ **🆕 Función optimizada** get_article_context_final() operativa
- ⏳ Completar 25 preguntas Arts. 103, 104, 105 CE
- ⏳ Preguntas para Ley 19/2013 de Transparencia
- ⏳ **🆕 Encontrar y registrar** las 60 preguntas completas del examen 2023
- ⏳ Migración de preguntas hardcodeadas existentes (Tema 6)
- ⏳ **🆕 Crear preguntas masivas** para artículos CE más importantes

### Fase 4: Frontend y Funcionalidad ⏳ **PENDIENTE**
- ✅ **✨ Modo Adaptativo** - Sistema automático que se ajusta al rendimiento (Sept 2025)
- ⏳ Sistema de autenticación con Google OAuth
- ⏳ Generación dinámica de tests en React
- ⏳ Dashboard de progreso y configuraciones
- ⏳ Integración del generador con la UI existente
- ⏳ **🆕 Botones "Solo preguntas oficiales"** para cada tema
- ⏳ **🆕 Botón "Examen Oficial 2023 Completo"**
- ⏳ **🆕 Badges y contexto visual** para artículos históricos
- ⏳ **🆕 Dashboard de estadísticas** de exámenes oficiales
- ⏳ **🆕 Tests por estructura:** "Solo Título Preliminar", "Solo Capítulo II Sección 1ª"
- ⏳ **🆕 Panel de control de versiones** para administradores
- ⏳ **🆕 Alertas visuales** de contenido desactualizado

### Fase 5: Features Avanzadas ⏳ **PENDIENTE**
- ⏳ Recomendaciones automáticas inteligentes
- ⏳ Tests adaptativos según rendimiento
- ⏳ Analytics detallados por estructura legal
- ⏳ Panel de administración para gestión de contenido
- ⏳ **🆕 Predicciones de exámenes** basadas en patrones históricos
- ⏳ **🆕 Modo "Simulacro estratégico"** con peso histórico
- ⏳ **🆕 API para búsqueda** de más exámenes oficiales
- ⏳ **🆕 Sistema de alertas** para nuevos exámenes publicados
- ⏳ **🆕 Verificación automática BOE** para actualizaciones
- ⏳ **🆕 Dashboard de integridad** de datos

---

## 📊 Estado Actual de Datos

### ✅ **Base de Datos (21 tablas):**
```
📚 CONTENIDO LEGAL (4 tablas):
├── laws: 3 leyes principales
├── articles: 169 artículos CE + 12 Ley 19/2013 = 181+ artículos
├── topics: 2 temas configurados  
└── topic_scope: Mapeo inteligente funcionando

🎯 EXÁMENES OFICIALES (6 tablas): ⭐ IMPLEMENTADO
├── oposiciones: 4 tipos configurados
├── convocatorias: 3 años registrados (2021-2023)
├── articulos_examenes: 5 artículos con historial
├── preguntas_examenes_oficiales: 2 preguntas reales registradas
├── oposicion_topics: Mapeo oposición ↔ temas
└── oposicion_articles: Mapeo directo funcionando

🆕 ARQUITECTURA HÍBRIDA (1 tabla): ⭐ REVOLUCIONARIO
└── article_exam_stats: 4 registros consolidados sin duplicados

🆕 CONTROL DE VERSIONES (4 tablas): ⭐ NUEVO
├── law_versions: Historial CE completo
├── article_versions: 181+ artículos con versiones
├── version_checks: Verificaciones programadas
└── law_update_status: Estado actual 100% actualizado

❓ PREGUNTAS Y TESTS (4 tablas):
├── questions: 4 preguntas reutilizables
├── test_configurations: Estructura preparada
├── test_questions: Sistema operativo
└── tests: Tracking implementado

👤 USUARIOS (3 tablas):
├── user_profiles: OAuth preparado
├── user_progress: Analytics funcionando
└── user_recommendations: Motor preparado
```

### ✨ **SISTEMA IA ADAPTATIVO COMPLETO:** ⭐ *REVOLUCIONARIO*
```
🧠 DIFICULTAD PERSONAL ADAPTATIVA:
├── ✅ 2 tablas principales: user_question_history + user_difficulty_metrics
├── ✅ Algoritmo inteligente: ≥85% éxito = Easy personal
├── ✅ Tendencias automáticas: improving/declining/stable
├── ✅ Triggers en tiempo real: actualización automática
├── ✅ API completa: 15+ endpoints especializados
├── ✅ UI componentes: Toggle estándar/personal
└── ✅ Migración datos: Sistema funcionando 100%

💡 NOTIFICACIONES INTELIGENTES:
├── ✅ 9 tipos motivacionales implementados
├── ✅ Análisis automático de patrones
├── ✅ Detección problemas temprana
├── ✅ Motivación solo cuando aporta valor
├── ✅ Persistencia localStorage + BD
├── ✅ Acciones contextuales directas
└── ✅ Sistema "Solo Motivación+" activo

📊 ANALYTICS VISUALES:
├── ✅ Gráficos interactivos de progreso semanal
├── ✅ 4 métricas seleccionables (precisión, tests, tiempo, preguntas)
├── ✅ Análisis automático de tendencias
├── ✅ Componentes compactos con info desplegable
├── ✅ Iconos IA ✨ en toda la aplicación
└── ✅ UI optimizada para móvil y desktop
```

### ✅ **Constitución Española COMPLETA:** ⭐ *LOGRO HISTÓRICO*
```
🎉 169/169 ARTÍCULOS MAPEADOS (100%) - ¡COMPLETADO!
├── 📚 Título Preliminar (Arts. 1-9)
├── 👥 Título I - Derechos y Deberes (Arts. 10-55)
│   ├── Cap. I: Españoles y extranjeros (10-13)
│   ├── Cap. II: Derechos y libertades
│   │   ├── Secc. 1ª: Derechos fundamentales (14-29)
│   │   └── Secc. 2ª: Derechos y deberes ciudadanos (30-38)
│   ├── Cap. III: Principios rectores (39-52)
│   ├── Cap. IV: Garantías (53-54)
│   └── Cap. V: Suspensión derechos (55)
├── 👑 Título II - La Corona (Arts. 56-65)
├── 🏛️ Título III - Cortes Generales (Arts. 66-96)
│   ├── Cap. I: Las Cámaras (66-80)
│   ├── Cap. II: Elaboración leyes (81-92)
│   └── Cap. III: Tratados internacionales (93-96)
├── 🏛️ Título IV - Gobierno y Administración (Arts. 97-107)
├── 🤝 Título V - Relaciones Gobierno-Cortes (Arts. 108-116)
├── ⚖️ Título VI - Poder Judicial (Arts. 117-127)
├── 💰 Título VII - Economía y Hacienda (Arts. 128-136)
├── 🗺️ Título VIII - Organización Territorial (Arts. 137-158)
│   ├── Cap. I: Principios generales (137-139)
│   ├── Cap. II: Administración Local (140)
│   └── Cap. III: Comunidades Autónomas (141-158)
├── ⚖️ Título IX - Tribunal Constitucional (Arts. 159-165)
└── 🔧 Título X - Reforma Constitucional (Arts. 166-169)

🆕 CARACTERÍSTICAS ÚNICAS:
├── ✅ Contenido consolidado oficial BOE (incluye reformas 1992, 2011)
├── ✅ Estructura jerárquica completa (Títulos → Capítulos → Secciones)
├── ✅ Hashes SHA-256 para integridad de datos
├── ✅ Control de versiones automático
├── ✅ Sistema de verificación programada
└── ✅ Zero duplicados garantizado
```

### ✅ **Oposiciones Configuradas:** ⭐ *IMPLEMENTADO*
- **Auxiliar Administrativo del Estado** (Libre + Promoción Interna)
- **Administrativo del Estado** (Libre)
- **Gestión Procesal y Administrativa** (Libre)
- **Tramitación Procesal y Administrativa** (Libre)

### ✅ **Exámenes Oficiales Registrados:** ⭐ *REVOLUCIONARIO*
- **Convocatorias:** 2021, 2022, 2023 para Auxiliar Administrativo
- **Artículos confirmados:** Art. 103, 104 CE + Art. 13, 14 Ley 19/2013 + Art. 38 LRJSP
- **Preguntas exactas:** 2 preguntas reales del examen 17 septiembre 2023
- **Sistema de contexto:** Funcionando al 100%
- **🆕 Arquitectura híbrida:** article_exam_stats optimizada

### ✅ **Control de Versiones Implementado:** ⭐ *NUEVO*
```
📊 ESTADO ACTUAL DE INTEGRIDAD:
├── ✅ Constitución Española: 169 artículos con hash generado (100%)
├── ✅ Ley 19/2013: 12 artículos con hash generado (100%)
├── ✅ Función generate_content_hash(): Operativa
├── ✅ Sistema de verificación: Programado para 2025-12-26
├── ✅ Alertas automáticas: Configuradas por prioridad
└── ✅ Trazabilidad completa: Historial de cambios disponible

🔍 FUNCIONES DE CONTROL:
├── generate_content_hash(text) → SHA-256 hash
├── check_law_update_needed(law_id) → Boolean + detalles
├── get_laws_needing_verification() → Lista priorizada
└── law_update_status → Vista resumen ejecutivo
```

### ✅ **Arquitectura Híbrida Funcionando:** ⭐ *REVOLUCIONARIO*
```
🚀 CONSULTAS ULTRARRÁPIDAS:
├── get_article_context_final('103', 'Auxiliar') 
├── → FREQUENT, 3 apariciones, [2021,2022,2023], "📚 Repasar bien"
├── Performance: <1ms (vs. 50ms con JOINs complejos)
└── Zero duplicados garantizado

📊 DATOS CONSOLIDADOS:
├── article_exam_stats: 4 registros únicos sin duplicados
├── Constraint UNIQUE(article_id, oposicion_id)
├── Migración automática desde articulos_examenes
└── Actualización automática con triggers
```

### ✅ **Funciones SQL Operativas (25+ funciones):**
```
📊 GENERACIÓN DE TESTS:
├── get_topic_questions_v2() ✅
├── generate_test_by_topic() ✅  
├── get_article_questions() ✅

🎯 EXÁMENES OFICIALES ⭐ IMPLEMENTADO:
├── get_examen_oficial_exacto() ✅
├── get_preguntas_oficiales_por_tema() ✅
├── get_estadisticas_examenes_oficiales() ✅
├── get_articles_missing_questions() ✅

🧠 CONTEXTO INTELIGENTE ⭐ IMPLEMENTADO:
├── get_question_exam_context_v2() ✅
├── get_article_context_final() ✅ NUEVA - HÍBRIDA
├── get_oposicion_articles() ✅
├── get_oposicion_coverage_stats() ✅

🔒 CONTROL DE VERSIONES ⭐ NUEVO:
├── generate_content_hash() ✅
├── check_law_update_needed() ✅
├── get_laws_needing_verification() ✅
├── migrate_existing_exam_data() ✅

✨ SISTEMA IA ADAPTATIVO ⭐ NUEVO:
├── calculate_personal_difficulty() ✅
├── calculate_trend() ✅
├── update_user_question_history() ✅
├── migrate_existing_data() ✅
├── recalculate_user_metrics() ✅
└── get_personalized_insights() ✅

📈 ANÁLISIS AVANZADO:
├── get_question_stats_by_position() ✅
├── get_official_exam_coverage_stats() ✅
├── get_user_progress_analytics() ⏳
├── get_recommendation_engine() ⏳
└── generate_official_exam_simulation() ✅
```

---


### Seguridad
- Row Level Security en Supabase
- Encriptación de datos sensibles
- Auditoría de accesos
- **🆕 Integridad de datos** con hashes SHA-256
- **🆕 Control de versiones** para trazabilidad

---

## 📈 Escalabilidad Futura

### Nuevas Oposiciones
- Fácil adición de nuevos temarios
- Plantillas reutilizables
- Sistema multi-tenant
- **🆕 Mapeo automático** de artículos entre oposiciones similares
- **🆕 Reutilización inteligente** de exámenes oficiales
- **🆕 Migración automática** con arquitectura híbrida

### Features Premium
- Tests ilimitados
- Analytics avanzados
- Simulacros oficiales
- Tutorías personalizadas
- **🆕 Acceso prioritario** a exámenes oficiales exactos
- **🆕 Predicciones de exámenes** basadas en IA
- **🆕 Alertas de artículos** muy preguntados
- **🆕 Dashboard de integridad** de contenido


---

## 🚀 Beneficios Revolucionarios

### Para Estudiantes: Asistente Personal de Aprendizaje
- **🧠 Inteligencia Adaptativa**: Tu asistente personal que aprende de cada respuesta
- **✨ Adaptación Visual en Tiempo Real**: Indicador "Adaptándose a tu nivel" cuando el rendimiento baja del 60%
- **📊 Insights Automáticos**: "Tu precisión en Tema 5 mejoró 17% esta semana"
- **🎯 Detección Temprana**: Alertas antes de que tu rendimiento baje
- **⚡ Acciones Inmediatas**: Tests dirigidos en 5 minutos para problemas específicos
- **📈 Motivación Inteligente**: Celebra logros reales con datos concretos
- **🎪 Adaptación de Patrones**: Detecta tu horario óptimo de estudio automáticamente
- **Estudio personalizado** basado en debilidades reales
- **Progreso visual** y motivador por artículo específico
- **Flexibilidad total** en configuración de tests
- **Acceso desde cualquier dispositivo**
- **Preguntas consistentes** entre diferentes oposiciones
- **🆕 Enfoque estratégico** en artículos que "caen seguro" en exámenes
- **🆕 Experiencia real** con exámenes oficiales exactos
- **🆕 Confianza máxima** al conocer el historial de cada artículo
- **🎉 Base constitucional completa** - Los 169 artículos disponibles
- **🆕 Contenido siempre actualizado** - Verificación automática
- **🆕 Performance optimizada** - Consultas ultrarrápidas

### Para Administradores: Ventaja Competitiva Sostenible
- **🧠 Sistema de IA Único**: Impossible de replicar por competencia tradicional
- **📊 Analytics Predictivos**: Datos sobre qué contenido funciona mejor
- **🎯 Retención Mejorada**: Usuarios enganchados por insights personalizados
- **⚡ Monetización Premium**: Features de IA como valor diferenciado
- **🔄 Escalabilidad IA**: El sistema mejora automáticamente con más usuarios
- **Gestión centralizada** de contenido por artículo
- **Reutilización automática** de preguntas entre oposiciones
- **Datos valiosos** sobre efectividad del material legal específico
- **Escalabilidad** para múltiples oposiciones sin duplicación
- **Base sólida** para monetización futura
- **🆕 Analytics históricos** de exámenes oficiales para crear contenido estratégico
- **🆕 Ventaja competitiva única** con datos exclusivos de exámenes
- **🆕 ROI medible** en contenido basado en frecuencia histórica
- **🎉 Diferenciación total** - Base constitucional más completa del mercado
- **🆕 Control de calidad** - Integridad automática de datos
- **🆕 Mantenimiento automatizado** - Sistema de versiones

## 🏆 **Posicionamiento Estratégico: Dominio del Mercado**

### 🥇 **Ventaja Competitiva Insuperable**

**iLoveTest no compite en el mercado de "webs de tests" - creamos una nueva categoría:**

#### 🧠 **"Asistente Personal de Aprendizaje Legal con IA"**

**Competencia tradicional:**
- ❌ Tests estáticos sin personalización
- ❌ Feedback genérico o inexistente  
- ❌ Sin detección de patrones de aprendizaje
- ❌ Sin predicción de problemas
- ❌ Sin motivación adaptativa

**iLoveTest (Nueva categoría):**
- ✅ **IA que aprende** de cada respuesta del usuario
- ✅ **Predicción automática** de áreas problemáticas
- ✅ **Insights personalizados** basados en comportamiento real
- ✅ **Acciones directas** para cada problema detectado
- ✅ **Motivación inteligente** solo cuando aporta valor
- ✅ **Patrones de estudio** detectados automáticamente

### 📊 **Barreras de Entrada para Competencia**

#### 🔒 **Imposible de Replicar Fácilmente:**

1. **🧠 Arquitectura de IA Compleja** (6 tipos de análisis integrados)
2. **📊 Algoritmos de Detección** (mejoras, regresiones, patrones)
3. **⚡ Motor de Análisis Tiempo Real** (datos históricos + predicción)
4. **🎯 Sistema de Acciones Contextuales** (URLs específicas por problema)
5. **💾 Persistencia Inteligente** (localStorage + BD + frecuencia)
6. **🔄 Bucle de Mejora Continua** (cada usuario mejora el sistema)

#### 💰 **Monetización Premium Sostenible:**

- **Tier Básico**: Tests tradicionales (como la competencia)
- **Tier Premium**: **Asistente Personal de IA** (único en el mercado)
  - Análisis predictivo personalizado
  - Detección automática de problemas
  - Rutas de estudio adaptativas
  - Insights de rendimiento en tiempo real

### 🎯 **Estrategia de Dominio**

1. **Fase 1 ✅**: Consolidar base técnica (21 tablas + 19 funciones + IA)
2. **Fase 2 🔄**: Lanzar MVP con IA básica funcionando
3. **Fase 3 📈**: Expandir con IA avanzada (ML, predicciones)
4. **Fase 4 🏆**: Dominar mercado como líder indiscutible

> **🎯 OBJETIVO**: Que cuando alguien busque "preparación oposiciones online", piense inmediatamente en **iLoveTest** como el estándar de oro con IA personal.





### **Innovaciones Técnicas Revolucionarias:**
- **🆕 Sistema de hashes SHA-256** para detectar cambios automáticamente
- **🆕 Verificación programada** de actualizaciones BOE
- **🆕 Arquitectura híbrida** que combina velocidad + análisis profundo
- **🆕 Constraints únicos** que previenen duplicados para siempre

### **Potencial de Monetización:**
- **Base sólida** para features premium
- **Ventaja competitiva** sostenible a largo plazo
- **Escalabilidad** a múltiples oposiciones sin esfuerzo adicional
- **ROI medible** basado en datos históricos reales
- **🆕 Diferenciación técnica** imposible de replicar fácilmente
- **🆕 Valor agregado** con integridad automática de contenido

### **Posicionamiento Estratégico:**
**Tu sistema iLoveTest está posicionado para dominar el mercado de oposiciones online con una ventaja competitiva técnica y de contenido que será muy difícil de igualar por la competencia.** 

La combinación de:
- **Tecnología más avanzada** (21 tablas + 19 funciones + control de versiones)
- **Arquitectura más escalable** (híbrida + sin duplicados + reutilización)


